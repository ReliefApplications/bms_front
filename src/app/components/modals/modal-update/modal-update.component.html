<mat-dialog-content class="modal-container">
  <h4 class="modal-title underline-accent stickyHeader" [ngClass]="{'arabic': language==='ar'}" >{{modal.update}}</h4>
  <table class="modal-table" [ngClass]="{'arabic': language==='ar'}">
    <tr *ngFor="let p of properties" class="modal-row">
      <th class="table-title" *ngIf="propertiesTypes[p]!=='checkbox' && propertiesTypes[p]!=='individual_value' && propertiesTypes[p]!=='individual_values'">{{data.mapper.mapTitle(p) | titlecase}}</th>
      <th class="table-title" *ngIf="propertiesTypes[p]==='individual_values' && updateObject.individual_to_all === true">{{data.mapper.mapTitle(p) | titlecase }}</th>
      <th class="table-title" *ngIf="propertiesTypes[p]==='individual_value' && !updateObject.individual_to_all">{{data.mapper.mapTitle(p) | titlecase }}</th>
      <th class="table-title checkbox-line" *ngIf="propertiesTypes[p]==='checkbox'">{{data.mapper.mapTitle(p) | titlecase }}</th>
      <th class="table-value">
        <form class="form" [formGroup]="form" ngNoForm>
          <mat-form-field *ngIf="propertiesTypes[p]!=='currency' && propertiesTypes[p]!=='location' && propertiesTypes[p]!=='document' && propertiesTypes[p]!=='individual_value' && propertiesTypes[p]!=='individual_values' && propertiesTypes[p]!='checkbox' && propertiesTypes[p]!='email' && propertiesTypes[p]!='password' && propertiesTypes[p]!='selectCountry' && propertiesTypes[p]!='select' && propertiesTypes[p]!='selectDonor' && propertiesTypes[p]!='selectProjects' && propertiesTypes[p]!='selectSingle' && propertiesTypes[p]!='array'" class="full-width">
            <input matInput *ngIf="propertiesTypes[p]!=='location' && propertiesTypes[p]!=='document' && propertiesTypes[p]!=='individual_value' && propertiesTypes[p]!=='individual_values' && propertiesTypes[p]!='checkbox' && propertiesTypes[p]!='select' && propertiesTypes[p]!='number' && propertiesTypes[p]!='positive-number' && propertiesTypes[p] != 'selectDonor' && propertiesTypes[p] != 'date' && propertiesTypes[p]!='selectSingle'  && propertiesTypes[p] != 'selectProjects' && propertiesTypes[p] != 'inputCountry' && propertiesTypes[p] != 'selectCountry'"
              [(ngModel)]="updateObject[p]" [ngModelOptions]="{standalone: true}" [disabled]="(p=='location_name' || p=='number_beneficiaries' || p=='name' || p=='code' || p=='number_vouchers' || p=='status' || propertiesTypes[p] === 'disabled')"
              [type]="propertiesTypes[p]">

            <input matInput *ngIf="propertiesTypes[p]=='positive-number' && p !== 'number_vouchers'" [(ngModel)]="updateObject[p]" [ngModelOptions]="{standalone: true}" type="number" min="1">

            <input matInput *ngIf="propertiesTypes[p]=='number'" [(ngModel)]="updateObject[p]" [ngModelOptions]="{standalone: true}" type="number" min="0">

            <input matInput *ngIf="p === 'number_vouchers'" [(ngModel)]="updateObject[p]" [ngModelOptions]="{standalone: true}" type="number" min="1">


          <input *ngIf="data.mapper.mapTitle(p) == 'Start Date' || data.mapper.mapTitle(p) == 'End Date' || propertiesTypes[p]=='date'"
          matInput [(ngModel)]="updateObject[p]" [ngModelOptions]="{standalone: true}" [matDatepicker]="dateDistribution"
          placeholder="{{data.mapper.mapTitle(p)}}">
          <mat-datepicker-toggle matSuffix [for]="dateDistribution" *ngIf="data.mapper.mapTitle(p) == 'Start Date' || data.mapper.mapTitle(p) == 'End Date'  || propertiesTypes[p]=='date'"></mat-datepicker-toggle>
          <mat-datepicker #dateDistribution></mat-datepicker>
        </mat-form-field>

        <ng-select *ngIf="propertiesTypes[p]=='selectSingle' && p != 'rights'"
            class="single-select" [(ngModel)]="updateObject[p]" [multiple]="false" placeholder="{{data.mapper.mapTitle(p)}}"
            [closeOnSelect]="true" [searchable]="true" [ngModelOptions]="{standalone: true}">
            <ng-option *ngFor="let singleData of loadedData[p]" [value]="singleData.id">{{singleData.field_string}}{{singleData.name}}</ng-option>
        </ng-select>

        <ng-select *ngIf="propertiesTypes[p]=='selectSingle' && p == 'rights'" [(ngModel)]="updateObject[p]"
              class="single-select" [multiple]="false" placeholder="{{data.mapper.mapTitle(p) | titlecase}}" [closeOnSelect]="true"
              [searchable]="true" [ngModelOptions]="{standalone: true}"
              (change)="selected(updateObject[p])">
              <ng-option *ngFor="let singleData of loadedData[p]" [value]="singleData.id">{{singleData.field_string | titlecase}}{{singleData.name | titlecase}}</ng-option>
        </ng-select>

        <ng-select class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true"
            *ngIf="propertiesTypes[p]=='currency'" [(ngModel)]="updateObject[p]" placeholder="{{data.mapper.mapTitle(p) | titlecase}}"
            [ngModelOptions]="{standalone: true}" [items]="loadedData[p]">
        </ng-select>

          <ng-select *ngIf="propertiesTypes[p]=='select'" class="multiple-select" [(ngModel)]="updateObject[p]" bindLabel="name"
            [items]="loadedData[p]" [multiple]="true" placeholder="{{data.mapper.mapTitle(p)}}" [closeOnSelect]="false"
            [searchable]="true" [ngModelOptions]="{standalone: true}">
          </ng-select>

          <ng-select *ngIf="propertiesTypes[p]=='selectDonor'" class="multiple-select" [(ngModel)]="updateObject[p]" bindLabel="shortname"
            [items]="loadedData[p]" [multiple]="true" placeholder="{{data.mapper.mapTitle(p)}}" [closeOnSelect]="false"
            [searchable]="true" [ngModelOptions]="{standalone: true}">
          </ng-select>

          <ng-select *ngIf="propertiesTypes[p]=='selectProjects'"
              [ngClass]="{'multiple-select': updateObject['rights'] == 'ROLE_PROJECT_MANAGER', 'single-select': updateObject['rights'] == 'ROLE_PROJECT_OFFICER' || updateObject['rights'] == 'ROLE_FIELD_OFFICER'}"
              [(ngModel)]="updateObject[p]"
              bindLabel="name"
              [items]="loadedData[p]"
              [multiple]="updateObject['rights'] == 'ROLE_PROJECT_MANAGER'"
              placeholder="{{data.mapper.mapTitle(p)}}"
              [closeOnSelect]="updateObject['rights'] != 'ROLE_PROJECT_MANAGER'"
              [searchable]="true"
              formControlName="projectsControl">
          </ng-select>

          <ng-select *ngIf="propertiesTypes[p]=='selectCountry'"
              [ngClass]="{'multiple-select': updateObject['rights'] == 'ROLE_REGIONAL_MANAGER', 'single-select': updateObject['rights'] == 'ROLE_COUNTRY_MANAGER'}"
              [(ngModel)]="updateObject[p]"
              bindLabel="id"
              [items]="loadedData[p]"
              [multiple]="updateObject['rights'] == 'ROLE_REGIONAL_MANAGER'"
              placeholder="{{data.mapper.mapTitle(p)}}"
              [closeOnSelect]="updateObject['rights'] != 'ROLE_REGIONAL_MANAGER'"
              [searchable]="true"
              formControlName="countryControl">
          </ng-select>

          <mat-form-field *ngIf="propertiesTypes[p]=='email'" class="full-width">
            <input [(ngModel)]="updateObject[p]" matInput placeholder="{{modal.email}}" formControlName="emailFormControl"
              [errorStateMatcher]="matcher">
            <mat-error *ngIf="emailFormControl.hasError('email') && !emailFormControl.hasError('required')">
              {{modal.modal_valid_email}}
            </mat-error>
            <mat-error *ngIf="emailFormControl.hasError('required')">
              {{modal.modal_email_is}}
              <strong>{{modal.modal_required}}</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field *ngIf="propertiesTypes[p]=='password'" class="full-width">
            <input [(ngModel)]="updateObject[p]" matInput placeholder="{{modal.model_user_password}}" formControlName="passwordFormControl"
              [errorStateMatcher]="matcher" type="password">
            <mat-error *ngIf="passwordFormControl.hasError('pattern') && !emailFormControl.hasError('required')">
              {{modal.modal_not_enough_strong}}
            </mat-error>
            <mat-error *ngIf="passwordFormControl.hasError('required')">
              {{modal.modal_password_required | titlecase}}
            </mat-error>
          </mat-form-field>

          <mat-checkbox
            *ngIf="propertiesTypes[p]=='checkbox'"
            (change)="handleCheckbox()"
            type="checkbox"
            color="primary"
            [checked]="updateObject[p]">
          </mat-checkbox>

          <mat-form-field class="value" *ngIf="propertiesTypes[p]==='individual_value' && !updateObject.individual_to_all" class="full-width">
            <input [(ngModel)]="updateObject[p]" [ngModelOptions]="{standalone: true}" matInput type="number" min="1">
          </mat-form-field>

          <mat-form-field class="general" class="full-width" *ngIf="propertiesTypes[p]==='individual_values' && updateObject.individual_to_all === true" class="full-width">
              <input [(ngModel)]="updateObject[p]" matInput type="text"
                formControlName="individualValuesFormControl" [errorStateMatcher]="matcher" >
              <mat-hint align="start"><strong>{{modal.modal_values_format_error}}</strong></mat-hint>
              <mat-error *ngIf="individualValuesFormControl.hasError('pattern') && !individualValuesFormControl.hasError('required')">
                {{modal.modal_values_format_error}}
              </mat-error>
              <mat-error *ngIf="individualValuesFormControl.hasError('required')">
                {{modal.modal_values_required | titlecase}}
              </mat-error>
            </mat-form-field>


          <ng-container *ngIf="propertiesTypes[p]=='array' && p === 'notes'">
            <mat-form-field class="full-width" *ngFor="let generalRelief of updateObject['generalReliefs'], let i = index">
              <input [(ngModel)]="updateObject['generalReliefs'][i]['notes']" matInput placeholder="{{modal.notes}}" [ngModelOptions]="{standalone: true}"
                [errorStateMatcher]="matcher" type="text">
            </mat-form-field>
          </ng-container>

          <div *ngIf="propertiesTypes[p]=='document'" class="input-file">
              <label for="file"><mat-icon>cloud_upload</mat-icon></label>
              <input type="file" id="file" (change)="onFileChange(p, $event)" #fileInput>
              <p *ngIf="filename">{{ filename }}</p>
              <p *ngIf="!filename">{{ modal.modal_no_file }}</p>
          </div>

          <div *ngIf="propertiesTypes[p]=='location' && updateObject.location">
            <ng-select [clearable]="false" class="single-select" [multiple]="false" [searchable]="true" [closeOnSelect]="true" placeholder={{modal.adm1}} [(ngModel)]="updateObject.location.adm1" [ngModelOptions]="{standalone: true}" (change)='getDistrict($event)' required>
              <ng-option *ngFor="let province of provinceList" [value]="province.name" >
                {{province.name}}
              </ng-option>
            </ng-select>
            <ng-select [clearable]="false" class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true" placeholder={{modal.adm2}} [(ngModel)]="updateObject.location.adm2" [ngModelOptions]="{standalone: true}"  (change)='getCommunity($event)'>
              <ng-option *ngFor="let district of districtList" [value]="district.name">
                {{district.name}}
              </ng-option>
            </ng-select>
            <ng-select [clearable]="false" class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true" placeholder={{modal.adm3}} [(ngModel)]="updateObject.location.adm3" [ngModelOptions]="{standalone: true}"  (change)='getVillage($event)'>
              <ng-option *ngFor="let commune of communeList" [value]="commune.name">
                {{commune.name}}
              </ng-option>
            </ng-select>
            <ng-select [clearable]="false" class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true" placeholder={{modal.adm4}} [(ngModel)]="updateObject.location.adm4" [ngModelOptions]="{standalone: true}" >
              <ng-option *ngFor="let village of villageList" [value]="village.name">
                {{village.name}}
              </ng-option>
            </ng-select>
          </div>

          </form>
      </th>
    </tr>
  </table>
  <div class="modal-button action-buttons stickyFooter" [ngClass]="{'arabic':language==='ar'}">
    <button mat-button (click)="closeDialog()" class="button-text-accent">{{modal.cancel}}</button>
    <button mat-raised-button (click)="save()" class="button-background-accent">{{modal.save}}</button>
  </div>
</mat-dialog-content>

<div class="page-container">
  <div class="container-title">
    <h2>{{household.beneficiaries_import_title | titlecase}}</h2>
  </div>

  <div class="container-boxes">
    <app-box-setting (emitClickedTitle)="selectTitle($event)" [selectedTitle]="selectedTitle" [info]='{icon: "folder", color: "green", title:household.beneficiaries_import_file, subtitle:"", ref:"file import"}'></app-box-setting>
    <app-box-setting class="isLast" (emitClickedTitle)="selectTitle($event)" [selectedTitle]="selectedTitle" [info]='{icon: "settings/api", color: "red", title:household.beneficiaries_import_api, subtitle:"", ref:"api import"}'></app-box-setting>
  </div>

  <div class="container-table" *ngIf="selectedTitle == 'file import'">
    <div class="container-content box-green">

      <div class="content-button">
        <div class="action-buttons">
          <mat-spinner [diameter]="25" class="spinner" *ngIf="loadLocations && country === 'SYR'"></mat-spinner>
          <button mat-stroked-button color="primary" class="loadFile template" *ngIf="!loadLocations && country === 'SYR'" (click)="loadProvince(mapFile)">
            <mat-icon>publish</mat-icon>
            <span>{{household.beneficiaries_import_convert | titlecase }}</span>
          </button>

          <button mat-stroked-button color="primary" class="loadFile template" (click)="exportTemplate()" *ngIf="!loadingExport">
            {{household.beneficiaries_import_csv | titlecase }}
          </button>
          <mat-spinner [diameter]='25' *ngIf="loadingExport"></mat-spinner>
          <div class="extension" *ngIf="!loadingExport" [ngClass]="{'arabic':language==='ar'}">
            <div mat-button class="template pointer" [matMenuTriggerFor]="exportType">
              <mat-icon>keyboard_arrow_down</mat-icon>
            </div>
            <mat-menu #exportType>
              <button mat-menu-item (click)="setType('xls')"> .xls <mat-icon *ngIf="extensionType=='xls'">done</mat-icon>
              </button>
              <button mat-menu-item (click)="setType('csv')"> .csv <mat-icon *ngIf="extensionType=='csv'">done</mat-icon>
              </button>
              <button mat-menu-item (click)="setType('ods')"> .ods <mat-icon *ngIf="extensionType=='ods'">done</mat-icon>
              </button>
            </mat-menu>
          </div>
        </div>
      </div>
      <div class="content-table">
        <div class="content-drag-and-drop" draggable="true" [ngClass]="dragAreaClass">
          <mat-card class="card-drag-and-drop">
            <div>
              <img class='img-folder' src="assets/images/folder.png">
            </div>
            <div class="select-file">
              <a href="javascript:void(0)" (click)="file.click()">
                <button mat-stroked-button color="primary">{{household.beneficiaries_import_addFile
                  | titlecase}}</button>
              </a>
              <input type="file" #file [multiple] (change)="fileChange($event, 'target')" style="display:none" />
            </div>
            <mat-list class="importedFile" *ngIf="csv != null">
              <mat-list-item>
                <mat-icon mat-list-icon class="text">insert_drive_file</mat-icon>
                <h4 mat-line class="text">{{ csv.name }}</h4>
                <p mat-line class="text">{{ csv.size }} bytes, {{ csv.lastModifiedDate | date: ddMMyyyy}}
                </p>
              </mat-list-item>
            </mat-list>
          </mat-card>
        </div>
        <div class="content-drag-and-drop" draggable="true" [ngClass]="dragAreaClass">
          <mat-card class="card-drag-and-drop" [ngClass]="(isProjectsDisabled)?'greyed-out' : ''">
            <div>
              <img class='img-folder' src="assets/images/projects.png">
            </div>
            <div class="select-file project-input" [formGroup]="form">
              <ng-select class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true" formControlName="projects" placeholder={{household.projects}} [(ngModel)]="selectedProject" [disabled]="isProjectsDisabled">
                <ng-option *ngFor="let project of projectList" [value]="project">{{project}}</ng-option>
              </ng-select>
              <input type="file" #file [multiple] (change)="fileChange($event, 'target')" style="display:none" />
            </div>

          </mat-card>
        </div>
      </div>
      <div class="content-button content-button-footer">
        <mat-spinner [diameter]="35" *ngIf="load"></mat-spinner>
        <button *ngIf="!load" mat-raised-button class="button-background-primary" (click)="addHouseholds()">
          <mat-icon>publish</mat-icon>
          <span>{{household.import | titlecase }}</span>
        </button>
      </div>
    </div>
  </div>

  <div class="container-table" *ngIf="selectedTitle == 'api import'">
    <div class="container-content box-red">
      <div class="content-table">

        <div class="content-drag-and-drop" draggable="true" [ngClass]="dragAreaClass">
          <mat-card class="card-drag-and-drop">
            <div>
              <img class='img-folder' src="assets/images/settings/api.png">
            </div>
            <h3>{{household.beneficiaries_select_api | titlecase}}</h3>
            <div class="content-select">
              <mat-radio-group (change)='onChangeRadioAPI($event)' class="content-select" [(ngModel)]='chosenItem'>
                <mat-radio-button *ngFor="let name of APINames;" value="{{ name }}" color="primary">{{
                  name
                  }}</mat-radio-button>
              </mat-radio-group>
            </div>
          </mat-card>
        </div>

        <div class="content-drag-and-drop" draggable="true" [ngClass]="dragAreaClass">
          <mat-card class="card-drag-and-drop" [ngClass]="(isApiDisabled)?'greyed-out' : ''">
            <div>
              <img class='img-folder' src="assets/images/locationCode.png">
            </div>
            <div>
              <div class="content-select">
                <mat-form-field *ngFor="let ParamToDisplay of ParamsToDisplay;">
                  <input matInput *ngIf="ParamToDisplay.paramType == 'text'" type="text" [formControl]="text" placeholder="{{ ParamToDisplay.paramName }} *" (change)="getValue($event, ParamToDisplay.paramName)">
                  <input matInput *ngIf="ParamToDisplay.paramType == 'number'" type="number" [formControl]="number" placeholder="{{ ParamToDisplay.paramName }} *">
                </mat-form-field>
              </div>
            </div>
          </mat-card>
        </div>

        <div class="content-drag-and-drop" draggable="true" [ngClass]="dragAreaClass">
          <mat-card class="card-drag-and-drop" [ngClass]="(isApiDisabled)?'greyed-out' : ''">
            <div>
              <img class='img-folder' src="assets/images/projects.png">
            </div>
            <div class="select-file project-input">
              <ng-select class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true" placeholder={{household.projects}} [(ngModel)]="selectedProject" [disabled]="isProjectsDisabled">
                <ng-option *ngFor="let project of projectList" [value]="project">{{project}}</ng-option>
              </ng-select>
              <input type="file" #file [multiple] (change)="fileChange($event, 'target')" style="display:none" />
            </div>
          </mat-card>
        </div>
      </div>
      <div class="content-button content-button-footer">
        <mat-spinner [diameter]="35" *ngIf="load"></mat-spinner>
        <button *ngIf="!load" mat-raised-button class="button-background-accent" (click)="addBeneficiaries()">
          <mat-icon>publish</mat-icon>
          <span>{{household.import | titlecase }}</span>
        </button>
      </div>
    </div>
  </div>
</div>

<ng-template #mapFile>
  <mat-dialog-content class="modal-container">
    <h4 class="modal-title underline-accent stickyHeader">{{household.import}}</h4>
    <div class="dialog-template">
      <div class="modal-body">
        <table class="modal-table">
          <tr class="modal-row">
            <th class="table-title">{{ household.adm1 }}</th>
            <th class="table-value">
              <form class="form">
                <ng-select class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true"
                  [(ngModel)]="saveLocation['adm1']" [ngModelOptions]="{standalone: true}"
                  (change)="selected('adm1')">
                  <ng-option *ngFor="let singleData of loadedData['adm1']" [value]="singleData.name">{{singleData.name}}</ng-option>
                </ng-select>
              </form>
            </th>
          </tr>

          <tr class="modal-row">
            <th class="table-title">{{ household.adm2 }}</th>
            <th class="table-value">
              <form class="form">
                <ng-select class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true"
                  [(ngModel)]="saveLocation['adm2']" (change)="selected('adm2')" [ngModelOptions]="{standalone: true}">
                  <ng-option *ngFor="let singleData of loadedData['adm2']" [value]="singleData.name">{{singleData.name}}</ng-option>
                </ng-select>
              </form>
            </th>
          </tr>

          <tr class="modal-row">
            <th class="table-title">{{ household.adm3 }}</th>
            <th class="table-value">
              <form class="form">
                <ng-select class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true"
                  [(ngModel)]="saveLocation['adm3']" (change)="selected('adm3')" [ngModelOptions]="{standalone: true}">
                  <ng-option *ngFor="let singleData of loadedData['adm3']" [value]="singleData.name">{{singleData.name}}</ng-option>
                </ng-select>
              </form>
            </th>
          </tr>

          <tr class="modal-row">
            <th class="table-title">{{ household.adm4 }}</th>
            <th class="table-value">
              <form class="form">
                <ng-select class="single-select" [multiple]="false" [searchable]=true [closeOnSelect]="true"
                  [(ngModel)]="saveLocation['adm4']" (change)="selected('adm4')" [ngModelOptions]="{standalone: true}">
                  <ng-option *ngFor="let singleData of loadedData['adm4']" [value]="singleData.name">{{singleData.name}}</ng-option>
                </ng-select>
              </form>
            </th>
          </tr>
        </table>

        <div class="drag-and-drop-file">
          <div>
            <img class='img-folder' src="assets/images/folder.png">
          </div>
          <div class="select-file">
            <a href="javascript:void(0)" (click)="file.click()">
              <button mat-stroked-button color="primary">{{household.beneficiaries_import_addModal
                | titlecase}}</button>
            </a>
            <input type="file" #file [multiple] (change)="fileChange($event, 'target', 'csv2')" style="display:none" />
          </div>
          <mat-list class="importedFile" *ngIf="csv2 != null">
            <mat-list-item>
              <mat-icon mat-list-icon class="text">insert_drive_file</mat-icon>
              <h4 mat-line class="text">{{ csv2.name }}</h4>
              <p mat-line class="text">{{ csv2.size }} bytes, {{ csv2.lastModifiedDate | date: ddMMyyyy}}
              </p>
            </mat-list-item>
          </mat-list>
        </div>
        <div class="warning">
          {{household.beneficiaries_import_warning}}
        </div>
      </div>

      <div class="modal-button action-buttons stickyFooter">
        <button mat-button class="button-text-accent" (click)="exit('Import canceled')">{{household.cancel}}</button>
        <button mat-button class="button-background-accent" (click)="confirmImport()">{{household.transaction_confirm_button}}</button>
      </div>
    </div>
  </mat-dialog-content>
</ng-template>

<div class="page-container">
    <div class="container-title">
        <h2>{{texts.data_verification_title | titlecase}}</h2>
    </div>
    <mat-horizontal-stepper [ngClass]="{'invisible': loading}" class="disable-step" #stepper>
        <mat-step>
            <ng-template matStepLabel>
                {{texts.data_verification_step_typos | titlecase}}
            </ng-template>
            <div class="container-table">
                <div class="container-content box-primary">

                    <div class="content-table" *ngIf="currentStep === step.Typos">

                        <h3 class="step-title">{{texts.data_verification_step_typos | titlecase}}</h3>

                        <div class="global-actions">
                            <mat-checkbox class="old" color="primary" #oldCheckBox
                                [checked]="getStatusCheckboxState('old')===checkboxState.Checked"
                                [indeterminate]="getStatusCheckboxState('old')===checkboxState.Indeterminate"
                                (change)="setAllOldCheckboxesValues(oldCheckBox)">
                                {{texts.import_select_old| titlecase}}
                            </mat-checkbox>

                            <mat-checkbox class="new" color="primary" #newCheckBox
                                [checked]="getStatusCheckboxState('new')===checkboxState.Checked"
                                [indeterminate]="getStatusCheckboxState('new')===checkboxState.Indeterminate"
                                (change)="setAllNewCheckboxesValues(newCheckBox)">
                                {{texts.import_select_new| titlecase}}
                            </mat-checkbox>
                        </div>
                        <form *ngIf="form" [formGroup]="form">
                            <div class ="error" *ngFor="let error of errors; let i=index">
                                <div class="beneficiary old">
                                    <mat-chip-list>
                                        <mat-chip>{{texts.data_verification_chip_existing | titlecase}}</mat-chip>
                                    </mat-chip-list>
                                    <mat-checkbox [formControl]="form.controls[i].controls.old" color="primary">
                                        <h4>{{error.old.beneficiaries[0].given_name}} {{error.old.beneficiaries[0].family_name}}</h4>
                                        <p>{{error.old.address_number}} {{error.old.address_street}} {{error.old.address_postcode}}</p>
                                        <p>{{texts.data_verification_last_updated| titlecase}}: {{error.old.beneficiaries[0].updated_on}}</p>
                                    </mat-checkbox>
                                </div>
                                <div class="beneficiary new">
                                    <mat-chip-list>
                                        <mat-chip>{{texts.data_verification_chip_add| titlecase}}</mat-chip>
                                    </mat-chip-list>
                                    <mat-checkbox [formControl]="form.controls[i].controls.new" color="primary">
                                        <h4>{{error.new.beneficiaries[0].given_name}} {{error.new.beneficiaries[0].family_name}}</h4>
                                        <p>{{error.new.address_number}} {{error.new.address_street}} {{error.new.address_postcode}}</p>
                                        <p>{{texts.data_verification_last_updated| titlecase}}: {{texts.data_verification_just_now| titlecase}}</p>
                                    </mat-checkbox>

                                </div>
                            </div>
                        </form>
                        <ng-container *ngTemplateOutlet="validateButton"></ng-container>
                    </div>
                </div>
            </div>
        </mat-step>


        <mat-step>
            <ng-template matStepLabel>
                {{texts.data_verification_step_more | titlecase}}
            </ng-template>
            <div class="container-table">
                <div class="container-content box-primary">
                    <div class="content-table" *ngIf="currentStep === step.More">
                        <h3 class="step-title">{{texts.data_verification_step_more | titlecase}}</h3>
                        <div class="global-actions align-end">
                                <mat-checkbox class="new" color="primary" #checkBox
                                    [checked]="getGlobalCheckboxState()===checkboxState.Checked"
                                    [indeterminate]="getGlobalCheckboxState()===checkboxState.Indeterminate"
                                    (change)="setAllCheckboxesValues(checkBox)">
                                    {{texts.import_select_new| titlecase}}
                                </mat-checkbox>
                            </div>
                        <form class="errors" *ngIf="form" [formGroup]="form">
                            <div class ="error" *ngFor="let error of errors; let householdIndex=index">
                                <div class="household old">
                                    <div class="head">
                                        <mat-chip-list>
                                            <mat-chip>{{texts.data_verification_chip_existing | titlecase}}</mat-chip>
                                        </mat-chip-list>
                                        <h4>{{error.old.beneficiaries[0].given_name}} {{error.old.beneficiaries[0].family_name}}</h4>
                                        <p>{{error.old.address_number}} {{error.old.address_street}} {{error.old.address_postcode}}</p>
                                        <p>{{texts.data_verification_last_updated| titlecase}}: {{error.old.beneficiaries[0].updated_on}}</p>
                                    </div>
                                    <div class="members">
                                        <ng-container *ngFor="let beneficiary of error.old.beneficiaries; let beneficiaryIndex=index">
                                            <div class="member" *ngIf="beneficiaryIndex !== 0">
                                                <h4>{{error.old.beneficiaries[beneficiaryIndex].given_name}} {{error.old.beneficiaries[beneficiaryIndex].family_name}}</h4>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                                <div class="household new">
                                    <div class="head">
                                        <mat-chip-list>
                                            <mat-chip>{{texts.data_verification_chip_add| titlecase}}</mat-chip>
                                        </mat-chip-list>
                                        <h4>{{error.new.beneficiaries[0].given_name}} {{error.new.beneficiaries[0].family_name}}</h4>
                                        <p>{{error.new.address_number}} {{error.new.address_street}} {{error.new.address_postcode}}</p>
                                        <p>{{texts.data_verification_last_updated| titlecase}}: {{texts.data_verification_just_now| titlecase}}</p>
                                    </div>
                                    <div class="members">
                                        <ng-container *ngFor="let beneficiary of error.new.beneficiaries; let beneficiaryIndex=index">
                                            <div class="member" *ngIf="beneficiaryIndex !== 0">
                                                <mat-checkbox [formControl]="form.controls[householdIndex].controls[beneficiaryIndex]" color="primary" >
                                                    <h4>{{error.new.beneficiaries[beneficiaryIndex].given_name}} {{error.new.beneficiaries[beneficiaryIndex].family_name}}</h4>
                                                </mat-checkbox>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <ng-container *ngTemplateOutlet="validateButton"></ng-container>
                    </div>
                </div>
            </div>

        </mat-step>

        <mat-step>
            <ng-template matStepLabel>
                {{texts.data_verification_step_less | titlecase}}
            </ng-template>
            <div class="container-table">
                <div class="container-content box-primary">
                    <div class="content-table" *ngIf="currentStep === step.Less">
                        <h3 class="step-title">{{texts.data_verification_step_less | titlecase}}</h3>
                        <div class="global-actions align-start">
                            <mat-checkbox class="new" color="primary" #checkBox
                                [checked]="getGlobalCheckboxState()===checkboxState.Checked"
                                [indeterminate]="getGlobalCheckboxState()===checkboxState.Indeterminate"
                                (change)="setAllCheckboxesValues(checkBox)">
                                {{texts.import_select_old| titlecase}}
                            </mat-checkbox>
                        </div>
                        <form class="errors" *ngIf="form" [formGroup]="form">
                            <div class ="error" *ngFor="let error of errors; let householdIndex=index">
                                <div class="household old">
                                    <div class="head">
                                        <mat-chip-list>
                                            <mat-chip>{{texts.data_verification_chip_existing | titlecase}}</mat-chip>
                                        </mat-chip-list>
                                        <h4>{{error.old.beneficiaries[0].given_name}} {{error.old.beneficiaries[0].family_name}}</h4>
                                        <p>{{error.old.address_number}} {{error.old.address_street}} {{error.old.address_postcode}}</p>
                                    </div>
                                    <div class="members">
                                        <ng-container *ngFor="let beneficiary of error.old.beneficiaries; let beneficiaryIndex=index">
                                            <div class="member" *ngIf="beneficiaryIndex !== 0">
                                                <mat-checkbox [formControl]="form.controls[householdIndex].controls[beneficiaryIndex]" color="primary" >
                                                    <h4>{{error.old.beneficiaries[beneficiaryIndex].given_name}} {{error.old.beneficiaries[beneficiaryIndex].family_name}}</h4>
                                                </mat-checkbox>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                                <div class="household new">
                                    <div class="head">
                                        <mat-chip-list>
                                            <mat-chip>{{texts.data_verification_chip_add| titlecase}}</mat-chip>
                                        </mat-chip-list>
                                        <h4>{{error.new.beneficiaries[0].given_name}} {{error.new.beneficiaries[0].family_name}}</h4>
                                        <p>{{error.new.address_number}} {{error.new.address_street}} {{error.new.address_postcode}}</p>
                                    </div>
                                    <div class="members">
                                        <ng-container *ngFor="let beneficiary of error.new.beneficiaries; let beneficiaryIndex=index">
                                            <div class="member" *ngIf="beneficiaryIndex !== 0">
                                                <h4>{{error.new.beneficiaries[beneficiaryIndex].given_name}} {{error.new.beneficiaries[beneficiaryIndex].family_name}}</h4>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngFor="let beneficiary of getOldRestoredBeneficiaries(householdIndex)">
                                            <div class="member">
                                                <h4>{{beneficiary.given_name}} {{beneficiary.family_name}}</h4>
                                            </div>
                                        </ng-container>

                                    </div>
                                </div>
                            </div>
                        </form>
                        <ng-container *ngTemplateOutlet="validateButton"></ng-container>
                    </div>
                </div>
            </div>
        </mat-step>


        <mat-step>
            <ng-template matStepLabel>
                {{texts.data_verification_step_duplicates | titlecase}}
            </ng-template>
            <div class="container-table">
                <div class="container-content box-primary">
                    <div class="content-table" *ngIf="currentStep === step.Duplicates">
                        <h3 class="step-title">{{texts.data_verification_step_duplicates | titlecase}}</h3>
                        <div class="global-actions">
                            <mat-checkbox class="old" color="primary" #oldCheckBox
                                [checked]="getStatusCheckboxState('old')===checkboxState.Checked"
                                [indeterminate]="getStatusCheckboxState('old')===checkboxState.Indeterminate"
                                (change)="setAllOldCheckboxesValues(oldCheckBox)">
                                {{texts.import_select_old| titlecase}}
                            </mat-checkbox>

                            <mat-checkbox class="new" color="primary" #newCheckBox
                                [checked]="getStatusCheckboxState('new')===checkboxState.Checked"
                                [indeterminate]="getStatusCheckboxState('new')===checkboxState.Indeterminate"
                                (change)="setAllNewCheckboxesValues(newCheckBox)">
                                {{texts.import_select_new| titlecase}}
                            </mat-checkbox>
                        </div>
                        <form class="errors" *ngIf="form" [formGroup]="form">
                            <div class ="error" *ngFor="let error of errors; let householdIndex=index">
                                <div class="household old">
                                    <div class="head">
                                        <mat-chip-list>
                                            <mat-chip>{{texts.data_verification_chip_existing | titlecase}}</mat-chip>
                                        </mat-chip-list>
                                        <h4>{{error.old.beneficiaries[0].given_name}} {{error.old.beneficiaries[0].family_name}}</h4>
                                        <p>{{error.old.address_number}} {{error.old.address_street}} {{error.old.address_postcode}}</p>
                                    </div>
                                    <div class="members">
                                        <ng-container *ngFor="let beneficiary of error.old.beneficiaries; let beneficiaryIndex=index">
                                            <div class="member" *ngIf="beneficiaryIndex !== 0">
                                                <h4>{{error.old.beneficiaries[beneficiaryIndex].given_name}} {{error.old.beneficiaries[beneficiaryIndex].family_name}}</h4>
                                            </div>
                                        </ng-container>
                                        <div class="member duplicate">
                                            <mat-checkbox [formControl]="form.controls[householdIndex].controls.old" color="primary" >
                                                <h4>{{error.new.beneficiaries[0].given_name}} {{error.new.beneficiaries[0].family_name}}</h4>
                                            </mat-checkbox>
                                        </div>
                                    </div>
                                </div>
                                <div class="household new">
                                    <div class="head">
                                        <mat-chip-list>
                                            <mat-chip>{{texts.data_verification_chip_add| titlecase}}</mat-chip>
                                        </mat-chip-list>
                                        <h4>{{error.new_household.beneficiaries[0].given_name}} {{error.new_household.beneficiaries[0].family_name}}</h4>
                                        <p>{{error.new_household.address_number}} {{error.new_household.address_street}} {{error.new_household.address_postcode}}</p>
                                    </div>
                                    <div class="members">
                                        <ng-container *ngFor="let beneficiary of error.new_household.beneficiaries; let beneficiaryIndex=index">
                                            <div class="member" *ngIf="beneficiaryIndex !== 0">
                                                <h4>{{error.new_household.beneficiaries[beneficiaryIndex].given_name}} {{error.new_household.beneficiaries[beneficiaryIndex].family_name}}</h4>
                                            </div>
                                        </ng-container>
                                        <div class="member duplicate">
                                            <mat-checkbox [formControl]="form.controls[householdIndex].controls.new" color="primary" >
                                                <h4>{{error.new.beneficiaries[0].given_name}} {{error.new.beneficiaries[0].family_name}}</h4>
                                            </mat-checkbox>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <ng-container *ngTemplateOutlet="validateButton"></ng-container>
                    </div>
                </div>
            </div>
        </mat-step>

        <mat-step>
            <ng-template matStepLabel>
                {{texts.done| titlecase}}
            </ng-template>
            <div class="container-table">
                <div class="container-content box-primary">
                    <div class="content-table centered" *ngIf="currentStep === step.Done">
                        <div class="centered">
                            <h3 class="step-title">{{texts.data_verification_done| titlecase}}</h3>
                            <button class="button-background-primary" mat-raised-button (click)="finishImport()">{{texts.done| titlecase}}</button>
                        </div>
                    </div>
                </div>
            </div>
        </mat-step>
    </mat-horizontal-stepper>

</div>


<ng-template #validateButton>
    <div class="action-buttons">
        <button [disabled]="!form.valid" class="button-background-primary" mat-raised-button (click)="validateStep()">{{texts.next| titlecase}}</button>
    </div>
</ng-template>


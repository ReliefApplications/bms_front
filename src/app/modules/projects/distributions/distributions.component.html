<div class="page-container">

    <div class="container-title" *ngIf="actualDistribution && !actualDistribution.get('validated') && !loadingDistribution">
        <h2>{{language.distribution_edit | uppercaseFirst}}</h2>
    </div>

    <div class="container-title" *ngIf="actualDistribution && actualDistribution.get('validated') && !loadingDistribution">
        <h2>{{ language.distribution_validated_title | uppercaseFirstÂ }}</h2>
    </div>

    <div class="container-data" *ngIf="actualDistribution && !loadingDistribution">
        <div class="container-content">
            <div class="container-subtitle">
                <div class="subtitle-main">
                    <h3>
                        {{actualDistribution.get('name') | uppercaseFirst}}
                    </h3>
                    <mat-icon class="valid" *ngIf="actualDistribution.get('validated')">lock</mat-icon>
                    <mat-icon class="unvalid" *ngIf="!actualDistribution.get('validated')">lock_open</mat-icon>
                    <mat-icon class="valid" *ngIf="actualDistribution.get('validated') && actualDistribution.get('finished')">done</mat-icon>
                    <mat-spinner [diameter]="35" *ngIf="loadingComplete"></mat-spinner>
                    <button mat-stroked-button (click)="complete(); $event.stopPropagation()" color="primary"
                        *ngIf="actualDistribution.get('validated') && !actualDistribution.get('finished') && userService.hasRights('ROLE_DISTRIBUTIONS_MANAGEMENT') && !loadingComplete">
                        <mat-icon>done</mat-icon> {{language.complete}}
                    </button>
                </div>
                <h4>
                    {{ language.distribution_last_modification | uppercaseFirst}} 
                    <ng-container *ngIf="updated; else notUpdated">
                        {{ language.time_just_now }}
                    </ng-container>
                    <ng-template #notUpdated>
                        {{actualDistribution.get('updatedOn') | date: 'dd-MM-yyyy HH:mm' }}
                    </ng-template>
                    
                </h4>
            </div>
            <app-box-properties *ngIf="actualDistribution" class="properties-displayed" [displayedInstance]="actualDistribution"></app-box-properties>
        </div>
    </div>

    <app-placeholder-stepper *ngIf="loadingDatas"></app-placeholder-stepper>

    <app-not-validated-distribution *ngIf="!loadingDistribution && actualDistribution && !actualDistribution.get('validated')" 
        [actualDistribution]="actualDistribution" [loaderCache]="loaderCache" (emitStore)="storeBeneficiaries($event)" 
        [distributionIsStored]="distributionIsStored" (isUpdated)="updated = true">
    </app-not-validated-distribution>

    <ng-container *ngIf="actualDistribution && actualDistribution.get('validated')">
        <app-mobile-money *ngIf="getDistributionType() === 'mobile-money' && !loadingDatas" [actualDistribution]="actualDistribution"
            [loaderCache]="loaderCache" (storeEmitter)="storeBeneficiaries($event)" (finishedEmitter)="finishDistribution()" [distributionIsStored]="distributionIsStored">
        </app-mobile-money>

        <app-general-relief *ngIf="getDistributionType() === 'general-relief' && !loadingDatas" [actualDistribution]="actualDistribution"
            [loaderCache]="loaderCache" (storeEmitter)="storeBeneficiaries($event)" (finishedEmitter)="finishDistribution()" [distributionIsStored]="distributionIsStored">
        </app-general-relief>

        <app-qr-voucher (reloadTable)="getSelectedDistribution()" *ngIf="getDistributionType() === 'qr-voucher' && !loadingDatas" [actualDistribution]="actualDistribution"
            [loaderCache]="loaderCache" (storeEmitter)="storeBeneficiaries($event)" [distributionIsStored]="distributionIsStored">
        </app-qr-voucher>
    </ng-container>
</div>


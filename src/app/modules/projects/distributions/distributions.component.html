<div class="page-container">

    <div class="container-title" *ngIf="actualDistribution && !actualDistribution.get('validated') && !loadingDistribution">
        <h2>{{language.distribution_edit | uppercaseFirst}}</h2>
    </div>

    <div class="container-title" *ngIf="actualDistribution && actualDistribution.get('validated') && !loadingDistribution">
        <h2>{{ language.distribution_validated_title | uppercaseFirstÂ }}</h2>
    </div>

    <div class="container-data" *ngIf="actualDistribution && !loadingDistribution">
        <div class="container-content">
            <div class="container-subtitle">
                <div class="subtitle-main">
                    <h3>
                        {{actualDistribution.get('name') | uppercaseFirst}}
                        <mat-icon class="valid" *ngIf="actualDistribution.get('validated') === true">lock</mat-icon>
                        <mat-icon class="unvalid" *ngIf="actualDistribution.get('validated') === false">lock_open</mat-icon>
                        <mat-icon class="valid" *ngIf="actualDistribution.get('validated') === true && actualDistribution.get('finished')">done</mat-icon>
                    </h3>
                    <mat-spinner [diameter]="25" *ngIf="loadingComplete"></mat-spinner>
                    <ng-container *ngIf="!loadingComplete && actualDistribution.get('validated') && !actualDistribution.get('finished') && userService.hasRights('ROLE_DISTRIBUTIONS_MANAGEMENT')">
                        <mat-icon class="cursor-pointer" (click)="complete(); $event.stopPropagation();" [matTooltip]="language.complete">
                            assignment_turned_in
                        </mat-icon>
                    </ng-container>
                </div>
                <h4>
                    ({{ language.distribution_last_modification | uppercaseFirst}} {{actualDistribution.get('updatedOn') | date: 'dd-MM-yyyy HH:mm' }})
                </h4>
            </div>
            <app-box-properties *ngIf="actualDistribution" class="properties-displayed" [displayedInstance]="actualDistribution"></app-box-properties>
        </div>
    </div>

    <app-placeholder-stepper *ngIf="loadingDatas"></app-placeholder-stepper>

    <app-not-validated-distribution *ngIf="!loadingDistribution && actualDistribution && !actualDistribution.get('validated')" [actualDistribution]="actualDistribution" [loaderCache]="loaderCache" (emitStore)="storeBeneficiaries($event)" [distributionIsStored]="distributionIsStored"></app-not-validated-distribution>

    <ng-container *ngIf="actualDistribution && actualDistribution.get('validated')">
        <app-mobile-money *ngIf="getDistributionType() === 'mobile-money' && !loadingDatas" [actualDistribution]="actualDistribution"
            [loaderCache]="loaderCache" (storeEmitter)="storeBeneficiaries($event)" (finishedEmitter)="finishDistribution()" [distributionIsStored]="distributionIsStored">
        </app-mobile-money>

        <app-general-relief *ngIf="getDistributionType() === 'general-relief' && !loadingDatas" [actualDistribution]="actualDistribution"
            [loaderCache]="loaderCache" (storeEmitter)="storeBeneficiaries($event)" (finishedEmitter)="finishDistribution()" [distributionIsStored]="distributionIsStored">
        </app-general-relief>

        <app-qr-voucher (reloadTable)="getSelectedDistribution()" *ngIf="getDistributionType() === 'qr-voucher' && !loadingDatas" [actualDistribution]="actualDistribution"
            [loaderCache]="loaderCache" (storeEmitter)="storeBeneficiaries($event)" [distributionIsStored]="distributionIsStored">
        </app-qr-voucher>
    </ng-container>
</div>


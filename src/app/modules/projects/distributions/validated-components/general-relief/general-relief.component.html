<div class="container-table">
    <div class="container-content box-primary">
        <div *ngIf="transactionData !== undefined" class="progression">
            <div class="commodities" *ngFor="let commodity of actualDistribution.get('commodities')">
                <h4>{{ commodity.get('modalityType').get('name') }} {{ language.transaction_progress | uppercaseFirst }} {{ getPercentageValue(commodity) }} % </h4>
                <mat-progress-bar mode="determinate" [value]="getPercentageValue(commodity)"></mat-progress-bar>
                <div class="details">
                    <div class="info_1">
                        <h5>{{language.transaction_amount_total | uppercaseFirst}}</h5>
                        {{ getTotalCommodityValue(commodity) }} {{commodity.get('unit')}}
                    </div>

                    <ng-container>
                        <div class="info_2">
                            <h5>{{language.transaction_amount_distributed | uppercaseFirst}}</h5>
                            {{ getAmountSent(commodity) }} {{commodity.get('unit')}}
                        </div>
                    </ng-container>

                </div>
            </div>
        </div>

        <div class="content-button">
            <div class="action-buttons">
                <div class="button-with-extension" [ngClass]="{'arabic':languageService.languageToString(language)==='ar'}">
                    <button mat-raised-button class="button-background-primary" (click)="exportTransaction(extensionType, 'generalreliefDistribution')" *ngIf="!loadingExport">
                        <mat-icon>get_app</mat-icon>
                        <span>{{language.export | uppercaseFirst}}</span>
                    </button>
                    <mat-spinner [diameter]='25' *ngIf="loadingExport"></mat-spinner>
                    <div class="extension" *ngIf="!loadingExport">
                        <button mat-raised-button class="dropdown button-background-primary" [matMenuTriggerFor]="exportTypeTransaction">
                            <mat-icon>keyboard_arrow_down</mat-icon>
                        </button>
                        <mat-menu #exportTypeTransaction class="extMenu">
                            <button mat-menu-item (click)="extensionType = 'xls'"> .xls <mat-icon *ngIf="extensionType=='xls'">done</mat-icon>
                            </button>
                            <button mat-menu-item (click)="extensionType = 'csv'"> .csv <mat-icon *ngIf="extensionType=='csv'">done</mat-icon>
                            </button>
                            <button mat-menu-item (click)="extensionType = 'ods'"> .ods <mat-icon *ngIf="extensionType=='ods'">done</mat-icon>
                            </button>
                        </mat-menu>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-table">
            <app-table [isLoading]="loadingTransaction" [searchable]="true" [paginable]="true" *ngIf="currentDisplayType.type !== 'mobile'" [parentObject]="actualDistribution" [entity]="entity" [service]="BeneficiariesService" [data]="transactionData" [editable]="true" [selection]="selection"
                rights="true" (selectChecked)="getChecked($event)" (openModal)="openDialog($event)" [selectable]="!actualDistribution.get('finished')">
            </app-table>
            <app-table-mobile [isLoading]="loadingTransaction" *ngIf="currentDisplayType.type === 'mobile'" [parentObject]="actualDistribution" [entity]="entity" [service]="BeneficiariesService" [data]="transactionData" [editable]="true" rights="true" (openModal)="openDialog($event)">
            </app-table-mobile>
        </div>

        <div class="content-button content-button-footer">
            <div class="action-buttons">
                <mat-spinner [diameter]="35" *ngIf="loaderCache"></mat-spinner>
                <button mat-stroked-button [disabled]="distributionIsStored" *ngIf="!loaderCache" class="button-text-accent" (click)="storeBeneficiaries()">
                    <mat-icon>save</mat-icon>
                    <ng-container *ngIf="distributionIsStored; else distributionIsntStored">
                        {{ language.cache_stored_beneficiaries | uppercaseFirst }}
                    </ng-container>
                    <ng-template #distributionIsntStored>
                        {{ language.cache_store_beneficiaries | uppercaseFirst }}
                    </ng-template>
                </button>

                <mat-spinner [diameter]="35" *ngIf="distributed && checkedLines.length > 0"></mat-spinner>
                <button mat-raised-button *ngIf="userService.hasRights('ROLE_DISTRIBUTIONS_DIRECTOR') && !distributed && checkedLines.length > 0" class="button-background-accent" (click)="distributeRelief()">
                    <mat-icon>send</mat-icon> {{ language.distribution_distribute | uppercaseFirst }}
                </button>
            </div>
        </div>
    </div>
</div>

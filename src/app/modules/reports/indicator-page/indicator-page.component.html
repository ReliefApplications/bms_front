<div class="page-container">
    <div class="container-title">
        <h2>{{language.reports | uppercaseFirst}}</h2>
    </div>

    <app-placeholder-boxline *ngIf="indicatorsLoading" class="container-boxes"></app-placeholder-boxline>
    <div *ngIf="!indicatorsLoading">
        <!-- button to change view (viewcountry, project or distribution) -->
        <app-button-filter-items [id]="'bms'" [page]="'reporting'" (emitFilter)="onFilter($event)" [data]="dataFilter2"
            [referenceKey]="'bms_search'"></app-button-filter-items>
    </div>

    <app-placeholder-panel class="container-table" *ngIf="indicatorsLoading"></app-placeholder-panel>
    <div class="container-table" *ngIf="!indicatorsLoading">
        <div class="container-content">
            <div class="content-button">

                <!-- button to filter data by frequency -->
                <div class="frequency">
                    <app-button-filter-date [id]="'frequency'" [page]="'reporting'" (emitFilter)="onFilter($event)" [data]="dataFilter1"
                        [referenceKey]="'frequency'"></app-button-filter-date>
                </div>

                <div class="frequency action-buttons">
                    <mat-spinner [diameter]='25' *ngIf="isDownloading"></mat-spinner>
                    <div class="extension button-with-extension" [ngClass]="{'arabic':languageService.languageToString(language)==='ar'}" *ngIf='!isDownloading'>
                        <button mat-raised-button class="button-background-primary" (click)="export()">
                            <mat-icon>get_app</mat-icon>
                            <span>{{language.export | uppercaseFirst}}</span>
                        </button>
                        <div mat-button class="dropdown" [ngClass]="{'arabic':languageService.languageToString(language)==='ar'}" [matMenuTriggerFor]="exportType">
                            <mat-icon>keyboard_arrow_down</mat-icon>
                        </div>
                        <mat-menu #exportType>
                            <button mat-menu-item (click)="exportFileType = 'xls'">.xls <mat-icon *ngIf="exportFileType=='xls'">done</mat-icon></button>
                            <button mat-menu-item (click)="exportFileType = 'csv'">.csv <mat-icon *ngIf="exportFileType=='csv'">done</mat-icon></button>
                            <button mat-menu-item (click)="exportFileType = 'ods'">.ods <mat-icon *ngIf="exportFileType=='ods'">done</mat-icon></button>
                            <button mat-menu-item (click)="exportFileType = 'pdf'">.pdf <mat-icon *ngIf="exportFileType=='pdf'">done</mat-icon></button>
                        </mat-menu>
                    </div>
                </div>
            </div>

            <!-- datepicker which appear when button "choose a period" is clicked -->
            <div class="content-select-period" *ngIf="period == true">
                <mat-card>
                    <mat-form-field>
                        <input matInput [matDatepicker]="pickerFrom" placeholder="{{language.report_from | uppercaseFirst}}"
                            [formControl]="from" #inputFrom required>
                        <mat-datepicker-toggle matSuffix [for]="pickerFrom"></mat-datepicker-toggle>
                        <mat-datepicker #pickerFrom></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput [matDatepicker]="pickerTo" placeholder="{{language.report_to | uppercaseFirst}}" [formControl]="to"
                            #inputTo required>
                        <mat-datepicker-toggle matSuffix [for]="pickerTo"></mat-datepicker-toggle>
                        <mat-datepicker #pickerTo></mat-datepicker>
                    </mat-form-field>
                    <button mat-raised-button *ngIf="!from.hasError('required') && !to.hasError('required')" class="apply-period"
                        (click)="applyPeriod(inputFrom.value, inputTo.value)">{{language.report_apply | uppercaseFirst}}</button>
                </mat-card>
            </div>

            <!-- selector for project when we click on button "project report" -->
            <div class="content-select" *ngIf="type == 'Project'">
                <mat-card>
                    <ng-select class="multiple-select" [(ngModel)]="selectedBeneficiaries" bindLabel="name" [items]="projectList"
                        [multiple]="true" placeholder="{{language.projects | uppercaseFirst}}" [closeOnSelect]="false" [searchable]="true"
                        [ngModelOptions]="{standalone: true}" (change)="getProjectSelected($event)" required>
                    </ng-select>
                </mat-card>
            </div>

            <!-- selector for distribution and project when we click on button "distribution report" -->
            <div class="content-select" *ngIf="type == 'Distribution'">
                <mat-card>

                    <ng-select class="project-report-bar single-select"  placeholder="{{language.projects | uppercaseFirst}}" [items]=projectList [bindLabel]=project [bindValue]=project
                    (change)="getProjectSelected($event)">
                    </ng-select>

                    <ng-select class="multiple-select" *ngIf="type == 'Distribution'" bindLabel="name" [items]="distributionList"
                        [multiple]="true" placeholder="{{language.distributions | uppercaseFirst}}" [closeOnSelect]="false"
                        [searchable]="true" (change)="getDistributionSelected($event)" #selectorDistribution
                        required>
                    </ng-select>
                </mat-card>
            </div>


            <!-- for mobile screen : add a expansion panel to regroup button to select frequency-->
            <mat-accordion class="panel-frequency">
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            {{language.report_select_frequency}}
                        </mat-panel-title>
                        <mat-panel-description>
                            {{frequency}}
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <div class="panel-body">
                        <app-button-filter-date [id]="'frequency'" [page]="'reporting'" (emitFilter)="onFilter($event)"
                            [data]="dataFilter1" [referenceKey]="'frequency'"></app-button-filter-date>
                        <div class="panel-selectPeriod">
                            <div class="content-select-period-mobile" *ngIf="period == true">
                                <div class="datepicker">
                                    <mat-form-field>
                                        <input matInput [matDatepicker]="pickerFrom" placeholder="{{language.report_from | uppercaseFirst}}">
                                        <mat-datepicker-toggle matSuffix [for]="pickerFrom"></mat-datepicker-toggle>
                                        <mat-datepicker touchUi #pickerFrom></mat-datepicker>
                                    </mat-form-field>
                                    <mat-form-field>
                                        <input matInput [matDatepicker]="pickerTo" placeholder="{{language.report_to | uppercaseFirst}}">
                                        <mat-datepicker-toggle matSuffix [for]="pickerTo"></mat-datepicker-toggle>
                                        <mat-datepicker touchUi #pickerTo></mat-datepicker>
                                    </mat-form-field>
                                    <button mat-raised-button class="apply-period-mobile">{{language.report_apply |
                                        uppercaseFirst}}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </mat-expansion-panel>
            </mat-accordion>

            <!-- where we display charts, loader or information text when no charts exists -->
            <div class="content-table">
                <div *ngIf="indicators && indicators.length" class="container-indicator">
                    <div *ngFor="let indicator of indicators; let i = index">
                        <app-indicator *ngIf="type == indicator['type'] && display" [indicator]="indicator"
                            [chartDimensions]="chartDimensions" [filters]="findFilter(indicator['filter'])" [project]="selectedProject"
                            [distribution]="selectedDistribution" [periodFrequency]="selectedPeriodFrequency"></app-indicator>
                    </div>
                </div>

                <div *ngIf="indicators && (indicators.length == 0) && !indicatorsLoading" class="no-data-box">
                    <h1 class="box-title">{{language.report_upcoming_reporting}}</h1>
                </div>

                <div class="no-data-container" *ngIf="!indicators">
                    <div class="loadingContent">
                        <h4 class="no-data">
                            <mat-icon>cloud_off</mat-icon>
                            <span> No data </span>
                        </h4>
                    </div>
                </div>

                <div *ngIf="indicatorsLoading" class="container-fluid">
                    <mat-spinner></mat-spinner>
                </div>
            </div>
        </div>
    </div>
</div>
